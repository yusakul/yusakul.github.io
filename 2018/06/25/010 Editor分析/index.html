<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="010 Editor v8.0.1_x32分析以及注册机制作"><meta name="keywords" content="逆向工程"><meta name="author" content="梁言,undefined"><meta name="copyright" content="梁言"><title>010 Editor v8.0.1_x32分析以及注册机制作 | 梁言</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css?version=1.5.5"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  localSearch: undefined
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#环境以及工具"><span class="toc-number">1.</span> <span class="toc-text">环境以及工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第一步-找到判断注册结果的关键跳转和关键函数"><span class="toc-number">2.</span> <span class="toc-text">第一步 找到判断注册结果的关键跳转和关键函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二步-分析关键函数1-返回DB为注册成功"><span class="toc-number">3.</span> <span class="toc-text">第二步 分析关键函数1(返回DB为注册成功)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第四步-分析用户名处理函数"><span class="toc-number">4.</span> <span class="toc-text">第四步 分析用户名处理函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第五步-处理计算结果"><span class="toc-number">5.</span> <span class="toc-text">第五步 处理计算结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第六步-编写注册机"><span class="toc-number">6.</span> <span class="toc-text">第六步 编写注册机</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">梁言</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">6</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">3</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container" style="background-image: url(true)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">梁言</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">010 Editor v8.0.1_x32分析以及注册机制作</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-06-25</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h3 id="环境以及工具"><a href="#环境以及工具" class="headerlink" title="环境以及工具"></a>环境以及工具</h3><blockquote>
<p>Window7_x32</p>
<p>010 Editor v8.0.1_x32</p>
<p>OD</p>
<p>VS2017</p>
</blockquote>
<h3 id="第一步-找到判断注册结果的关键跳转和关键函数"><a href="#第一步-找到判断注册结果的关键跳转和关键函数" class="headerlink" title="第一步 找到判断注册结果的关键跳转和关键函数"></a>第一步 找到判断注册结果的关键跳转和关键函数</h3><blockquote>
<p>使用OD打开010editor，进入到注册界面，先尝试输入随意的ID和Key，获取弹出的提示信息字符串</p>
</blockquote>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-25/18287022.jpg" alt=""></p>
<blockquote>
<p>尝试在OD中搜索如下字符 “Invalid name or password.”，搜索结果如下</p>
</blockquote>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-25/82561798.jpg" alt=""></p>
<blockquote>
<p>发现存在大量提示信息，我们在其中找到注册成功的提示信息，（上图红框：感谢购买010editor），双击查看反汇编窗口，见下图。</p>
</blockquote>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-25/57856353.jpg" alt=""></p>
<blockquote>
<p>往上查看判断注册成功的关键跳转</p>
</blockquote>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-25/70209865.jpg" alt=""></p>
<blockquote>
<p>我们发现地址为00DD5926处跳转JNZ 010Edito.00DD5A58应该为关键跳转，下方可以找到输出字符串”Password accepted. This ….”， 而其跳转地址处汇编代码为输出”Password accepted….”</p>
<p>（010editor使用<em>QT</em>界面库编写 ，我们可以猜测出push字符串随后的函数应为输出字符串）</p>
</blockquote>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-25/22668034.jpg" alt=""></p>
<blockquote>
<p>回到关键跳转00DD5926处，判断密码为正确的条件为EDI = 0xDB，而EDI的值是EAX给的，而EAX为函数010Edito.00409C9B的返回值，这个函数可能为验证Key的关键函数，而我们动态调试发现有跳转直接跳转到cmp edi,0xdb。</p>
</blockquote>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-25/93217778.jpg" alt=""></p>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-25/18045030.jpg" alt=""></p>
<blockquote>
<p>同样为函数010Edito.00409C9B，现在可以认为这是关键函数，此时EDI的值为0x177，为了验证此跳转为关键跳转，我们把EDI的值修改为0xDB。</p>
</blockquote>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-25/13306046.jpg" alt=""></p>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-25/90664364.jpg" alt=""></p>
<blockquote>
<p>之后F9运行</p>
</blockquote>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-25/56983231.jpg" alt=""></p>
<blockquote>
<p>验证成功！接下来我们进入函数分析。</p>
</blockquote>
<h3 id="第二步-分析关键函数1-返回DB为注册成功"><a href="#第二步-分析关键函数1-返回DB为注册成功" class="headerlink" title="第二步 分析关键函数1(返回DB为注册成功)"></a>第二步 分析关键函数1(返回DB为注册成功)</h3><blockquote>
<p>函数010Edito.00409C9B，参数情况为：</p>
<p>arg1 = 0x9 ；</p>
<p>arg2 = 0x4389；</p>
</blockquote>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-25/43180291.jpg" alt=""></p>
<blockquote>
<p>从下往上看，找到需要的0xDB，而跳转条件是eax = 0x2D， 为函数010Edito.0040A826的返回值。</p>
</blockquote>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-25/16623615.jpg" alt=""></p>
<p>###第三步 分析关键函数2(返回2D为注册成功)</p>
<blockquote>
<p>进入函数，该函数作用为将key取出，放在在局部变量数组中，数组起始地址为ebx-24</p>
</blockquote>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-25/20577830.jpg" alt=""></p>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-25/95763028.jpg" alt=""></p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; key[0 ]	= [ebx-24]=0x12</span><br><span class="line">&gt; key[1 ]	= [ebx-23]=0x34</span><br><span class="line">&gt; key[2 ]	= [ebx-22]=0x56</span><br><span class="line">&gt; key[3 ]	= [ebx-21]=0x78</span><br><span class="line">&gt; key[4 ]	= [ebx-20]=0x90</span><br><span class="line">&gt; key[5 ]	= [ebx-1F]=0x12</span><br><span class="line">&gt; key[6 ]	= [ebx-1E]=0x34</span><br><span class="line">&gt; key[7 ]	= [ebx-1D]=0x56</span><br><span class="line">&gt; key[8 ]	= [ebx-1C]=0x78</span><br><span class="line">&gt; key[9 ]	= [ebx-1B]=0x90</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>密钥数组对应如上，该处汇编代码如下，当KEY[3] == 0x9C时</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&gt; 013BDC5D   .  8A5D DF       MOV BL,BYTE PTR SS:[EBP-0x21]    ;  key[3]</span><br><span class="line">&gt; 013BDC60   .  8A7D E1       MOV BH,BYTE PTR SS:[EBP-0x1F]    ;  key[5]</span><br><span class="line">&gt; 013BDC63   .  80FB 9C       CMP BL,0x9C                      ;  是否等于0x9c</span><br><span class="line">&gt; 013BDC66   .  75 70         JNZ SHORT 010Edito.013BDCD8      ;  跳转到是否等于FC</span><br><span class="line">&gt; 013BDC68   .  8A45 DC       MOV AL,BYTE PTR SS:[EBP-0x24]    ;  key[0]</span><br><span class="line">&gt; 013BDC6B   .  3245 E2       XOR AL,BYTE PTR SS:[EBP-0x1E]    ;  key[0]^key[6]</span><br><span class="line">&gt; 013BDC6E   .  8845 E8       MOV BYTE PTR SS:[EBP-0x18],AL	;</span><br><span class="line">&gt; 013BDC71   .  8A45 DD       MOV AL,BYTE PTR SS:[EBP-0x23]	;  key[1]</span><br><span class="line">&gt; 013BDC74   .  3245 E3       XOR AL,BYTE PTR SS:[EBP-0x1D]	;  key[1]^key[7]</span><br><span class="line">&gt; 013BDC77   .  FF75 E8       PUSH DWORD PTR SS:[EBP-0x18]</span><br><span class="line">&gt; 013BDC7A   .  0FB6C8        MOVZX ECX,AL</span><br><span class="line">&gt; 013BDC7D   .  B8 00010000   MOV EAX,0x100</span><br><span class="line">&gt; 013BDC82   .  66:0FAFC8     IMUL CX,AX					  ;  (key[1]^key[7])*0x100</span><br><span class="line">&gt; 013BDC86   .  8A45 DE       MOV AL,BYTE PTR SS:[EBP-0x22]    ;  key[2]</span><br><span class="line">&gt; 013BDC89   .  32C7          XOR AL,BH					  ;	 key[2]^key[5]</span><br><span class="line">&gt; 013BDC8B   .  0FB6C0        MOVZX EAX,AL</span><br><span class="line">&gt; 013BDC8E   .  66:03C8       ADD CX,AX					     		   	 	 		</span><br><span class="line">&gt; ;cx = (key[1]^key[7])*0x100 + key[2]^key[5]</span><br><span class="line">&gt; 013BDC91   .  0FB7F1        MOVZX ESI,CX</span><br><span class="line">&gt; 013BDC94   .  E8 AB9904FF   CALL 010Edito.00407644					</span><br><span class="line">&gt; 	013BD0B0  /&gt; \55            PUSH EBP</span><br><span class="line">&gt; 	013BD0B1  |.  8BEC          MOV EBP,ESP</span><br><span class="line">&gt; 	013BD0B3  |.  8B45 08       MOV EAX,[ARG.1]	</span><br><span class="line">&gt; 	;  eax = key[0]^key[6] </span><br><span class="line">&gt; 	013BD0B6  |.  34 18         XOR AL,0x18		</span><br><span class="line">&gt; 	;  al = key[0]^key[6]^0x18 </span><br><span class="line">&gt; 	013BD0B8  |.  04 3D         ADD AL,0x3D		</span><br><span class="line">&gt; 	;  al =	key[0]^key[6]^0x18 + 0x3D</span><br><span class="line">&gt; 	013BD0BA  |.  34 A7         XOR AL,0xA7		</span><br><span class="line">&gt; 	;  al =(key[0]^key[6]^0x18+0x3D)^0xA7</span><br><span class="line">&gt; 	013BD0BC  |.  5D            POP EBP                          </span><br><span class="line">&gt; 	013BD0BD  \.  C3            RETN</span><br><span class="line">&gt; 	</span><br><span class="line">&gt; 013BDC99   .  0FB6C0        MOVZX EAX,AL</span><br><span class="line">&gt; 013BDC9C   .  56            PUSH ESI          </span><br><span class="line">&gt; ;  esi = (key[1]^key[7])*0x100 + key[2]^key[5]</span><br><span class="line">&gt; 013BDC9D   .  8947 1C       MOV DWORD PTR DS:[EDI+0x1C],EAX</span><br><span class="line">&gt; 013BDCA0   .  E8 23A704FF   CALL 010Edito.004083C8</span><br><span class="line">&gt; 	013BD020  /&gt; \55            PUSH EBP</span><br><span class="line">&gt; 	013BD021  |.  8BEC          MOV EBP,ESP</span><br><span class="line">&gt; 	013BD023  |.  8B45 08       MOV EAX,[ARG.1]		</span><br><span class="line">&gt; 	;eax=(key[1]^key[7])*100+key[2]^key[5]</span><br><span class="line">&gt; 	013BD026  |.  B9 0B000000   MOV ECX,0xB			</span><br><span class="line">&gt; 	; ecx = 0xB</span><br><span class="line">&gt; 	013BD02B  |.  35 92780000   XOR EAX,0x7892		</span><br><span class="line">&gt; 	;eax=((key[1]^key[7])*0x100+key[2]^key[5])^0x7892</span><br><span class="line">&gt; 	013BD030  |.  05 304D0000   ADD EAX,0x4D30</span><br><span class="line">&gt; 	;eax=((key[1]^key[7])*0x100+key[2]^key[5])^0x7892 + 0x4D30</span><br><span class="line">&gt; 	013BD035  |.  35 21340000   XOR EAX,0x3421</span><br><span class="line">&gt; 	;eax=(((key[1]^key[7])*0x100+key[2]^key[5])^0x7892 + 0x4D30)^0x3421</span><br><span class="line">&gt; 	013BD03A  |.  0FB7C0        MOVZX EAX,AX</span><br><span class="line">&gt; 	013BD03D  |.  99            CDQ</span><br><span class="line">&gt; 	013BD03E  |.  F7F9          IDIV ECX		</span><br><span class="line">&gt; 	;eax=(((key[1]^key[7])*0x100+key[2]^key[5])^0x7892 + 0x4D30)^0x3421/0xB</span><br><span class="line">&gt; 	013BD040  |.  85D2          TEST EDX,EDX	;eax/ecx的余数是否为0</span><br><span class="line">&gt; 	013BD042  |.  74 02         JE SHORT 010Edito.013BD046	;如果余数不为0,清零eax</span><br><span class="line">&gt; 	013BD044  |.  33C0          XOR EAX,EAX</span><br><span class="line">&gt; 	013BD046  |&gt;  5D            POP EBP                                </span><br><span class="line">&gt; 	013BD047  \.  C3            RETN</span><br><span class="line">&gt; </span><br><span class="line">&gt; 013BDCA5   .  8B4F 1C       MOV ECX,DWORD PTR DS:[EDI+0x1C]</span><br><span class="line">&gt; ; ecx = (key[0]^key[6]^0x18+0x3D)^0xA7</span><br><span class="line">&gt; 013BDCA8   .  83C4 08       ADD ESP,0x8		</span><br><span class="line">&gt; 013BDCAB   .  0FB7C0        MOVZX EAX,AX</span><br><span class="line">&gt; ;eax=(((key[1]^key[7])*100+key[2]^key[5])^0x7892 + 0x4D30)^0x3421</span><br><span class="line">&gt; 013BDCAE   .  8947 20       MOV DWORD PTR DS:[EDI+0x20],EAX</span><br><span class="line">&gt; ;[EDI+0x20] =(((key[1]^key[7])*100+key[2]^key[5])^0x7892 + 0x4D30)^0x3421/0xB</span><br><span class="line">&gt; 013BDCB1   .  85C9          TEST ECX,ECX	</span><br><span class="line">&gt; 013BDCB3   .  0F84 BC010000 JE 010Edito.013BDE75	;ecx = 0 则eax=E7返回，验证失败</span><br><span class="line">&gt; 013BDCB9   .  85C0          TEST EAX,EAX</span><br><span class="line">&gt; 013BDCBB   .  0F84 B4010000 JE 010Edito.013BDE75	;eax = 0 则eax=E7返回，验证失败</span><br><span class="line">&gt; 013BDCC1   .  3D E8030000   CMP EAX,0x3E8</span><br><span class="line">&gt; 013BDCC6   .  0F87 A9010000 JA 010Edito.013BDE75	;eax &gt; 0x3E8 则eax=E7返回，验证失败</span><br><span class="line">&gt; 013BDCCC   .  83F9 02       CMP ECX,0x2				;ecx小于等于1时，借位cf=1,否则cf=0</span><br><span class="line">&gt; 013BDCCF   .  1BF6          SBB ESI,ESI				; esi=esi-esi-CF=-cf</span><br><span class="line">&gt; 013BDCD1   .  23F1          AND ESI,ECX				;esi = esi &amp; ecx	</span><br><span class="line">&gt; 013BDCD3   .  E9 B3000000   JMP 010Edito.013BDD8B	;0xAC分支也跳转到这里013BDD8B</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>当KEY[3] == 0x9C时，等换成C为</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">case</span> <span class="number">0x9C</span>:</span><br><span class="line">&gt; &#123;</span><br><span class="line">&gt;     [EDI+<span class="number">0x1C</span>] = (key[<span class="number">0</span>]^key[<span class="number">6</span>]^<span class="number">0x18</span>+<span class="number">0x3D</span>)^<span class="number">0xA7</span>;	<span class="comment">//最后一步验证用到</span></span><br><span class="line">&gt;     [EDI+<span class="number">0x20</span>] =(((key[<span class="number">1</span>]^key[<span class="number">7</span>])*<span class="number">0x100</span>+key[<span class="number">2</span>]^key[<span class="number">5</span>])^<span class="number">0x7892</span> + <span class="number">0x4D30</span>)^<span class="number">0x3421</span>;</span><br><span class="line">&gt;     eax=(((key[<span class="number">1</span>]^key[<span class="number">7</span>])*<span class="number">0x100</span>+key[<span class="number">2</span>]^key[<span class="number">5</span>])^<span class="number">0x7892</span> + <span class="number">0x4D30</span>)^<span class="number">0x3421</span>;</span><br><span class="line">&gt;     ecx = (key[<span class="number">0</span>]^key[<span class="number">6</span>]^<span class="number">0x18</span>+<span class="number">0x3D</span>)^<span class="number">0xA7</span>;</span><br><span class="line">&gt;     cf = <span class="number">0</span>;</span><br><span class="line">&gt;     <span class="keyword">if</span>(eax % <span class="number">0xB</span> != <span class="number">0</span>)</span><br><span class="line">&gt;     &#123;</span><br><span class="line">&gt;         eax = <span class="number">0</span>;</span><br><span class="line">&gt;     &#125; </span><br><span class="line">&gt;     <span class="keyword">if</span>(ecx == <span class="number">0</span> || eax == <span class="number">0</span> || eax  &gt; <span class="number">0x3E8</span>)</span><br><span class="line">&gt;     &#123;</span><br><span class="line">&gt;       	<span class="comment">//验证失败</span></span><br><span class="line">&gt;         <span class="keyword">return</span>;</span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt;     <span class="keyword">else</span> </span><br><span class="line">&gt;     &#123;</span><br><span class="line">&gt;     </span><br><span class="line">&gt;     	eax=(((key[<span class="number">1</span>]^key[<span class="number">7</span>])*<span class="number">0x100</span>+key[<span class="number">2</span>]^key[<span class="number">5</span>])^<span class="number">0x7892</span> + <span class="number">0x4D30</span>)^<span class="number">0x3421</span>/<span class="number">0xB</span>;</span><br><span class="line">&gt;          [EDI+<span class="number">0x20</span>] = eax;</span><br><span class="line">&gt;         <span class="keyword">if</span>(ecx &lt;= <span class="number">1</span>)</span><br><span class="line">&gt;         &#123;</span><br><span class="line">&gt;             cf = <span class="number">1</span>;</span><br><span class="line">&gt;         &#125;</span><br><span class="line">&gt;         esi = (<span class="number">0</span> - cf) &amp; ecx;	<span class="comment">//cf=0 则 esi=0;</span></span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt;     <span class="keyword">break</span>;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>当KEY[3] == 0xFC时，所有跳转最终都不返回我们需要的0x2D ，跳过。</p>
<p>当KEY[3] == 0xAC时</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&gt; 013BDCFC   &gt; \80FB AC       CMP BL,0xAC</span><br><span class="line">&gt; 013BDCFF   .  0F85 70010000 JNZ 010Edito.013BDE75</span><br><span class="line">&gt; 013BDD05   .  8A45 DD       MOV AL,BYTE PTR SS:[EBP-0x23]                                ; al = key[1]</span><br><span class="line">&gt; 013BDD08   .  3245 E3       XOR AL,BYTE PTR SS:[EBP-0x1D]                                ; al = key[1]^key[7]</span><br><span class="line">&gt; 013BDD0B   .  0FB6C8        MOVZX ECX,AL										     ; ecx = key[1]^key[7]</span><br><span class="line">&gt; 013BDD0E   .  B8 00010000   MOV EAX,0x100</span><br><span class="line">&gt; 013BDD13   .  66:0FAFC8     IMUL CX,AX												; cx = (key[1]^key[7]) * 0x100</span><br><span class="line">&gt; 013BDD17   .  8A45 DE       MOV AL,BYTE PTR SS:[EBP-0x22]							  ;  al = key[2]</span><br><span class="line">&gt; 013BDD1A   .  32C7          XOR AL,BH												; al = key[2]^key[5]</span><br><span class="line">&gt; 013BDD1C   .  C747 1C 02000&gt;MOV DWORD PTR DS:[EDI+0x1C],0x2							  ;[edi+0x1C] = 0x2</span><br><span class="line">&gt; 013BDD23   .  0FB6C0        MOVZX EAX,AL											; eax = key[2]^key[5]</span><br><span class="line">&gt; 013BDD26   .  66:03C8       ADD CX,AX												; cx = (key[1]^key[7]) * 0x100 + key[2]^key[5]</span><br><span class="line">&gt; 013BDD29   .  0FB7C1        MOVZX EAX,CX											; eax = (key[1]^key[7]) * 0x100 + key[2]^key[5]</span><br><span class="line">&gt; 013BDD2C   .  50            PUSH EAX</span><br><span class="line">&gt; 013BDD2D   .  E8 96A604FF   CALL 010Edito.004083C8</span><br><span class="line">&gt; 	013BD020  /&gt; \55            PUSH EBP</span><br><span class="line">&gt; 	013BD021  |.  8BEC          MOV EBP,ESP</span><br><span class="line">&gt; 	013BD023  |.  8B45 08       MOV EAX,[ARG.1]										</span><br><span class="line">&gt; 	013BD026  |.  B9 0B000000   MOV ECX,0xB</span><br><span class="line">&gt; 	013BD02B  |.  35 92780000   XOR EAX,0x7892										;   	eax = ((key[1]^key[7]) * 0x100 + key[2]^key[5])^0x7892</span><br><span class="line">&gt; 	013BD030  |.  05 304D0000   ADD EAX,0x4D30									    ;   	eax = ((key[1]^key[7]) * 0x100 + key[2]^key[5])^0x7892 + 0x4D30</span><br><span class="line">&gt; 	013BD035  |.  35 21340000   XOR EAX,0x3421									    ;   	eax = (((key[1]^key[7]) * 0x100 + key[2]^key[5])^0x7892 + 0x4D30)^0x3421</span><br><span class="line">&gt; 	013BD03A  |.  0FB7C0        MOVZX EAX,AX</span><br><span class="line">&gt; 	013BD03D  |.  99            CDQ</span><br><span class="line">&gt; 	013BD03E  |.  F7F9          IDIV ECX									        ;   	eax = ((((key[1]^key[7]) * 0x100 + key[2]^key[5])^0x7892 + 0x4D30)^0x3421)/0xB</span><br><span class="line">&gt; 	013BD040  |.  85D2          TEST EDX,EDX										;    	 余数edx != 0 则，eax=0</span><br><span class="line">&gt; 	013BD042  |.  74 02         JE SHORT 010Edito.013BD046</span><br><span class="line">&gt; 	013BD044  |.  33C0          XOR EAX,EAX</span><br><span class="line">&gt; 	013BD046  |&gt;  5D            POP EBP                                                  </span><br><span class="line">&gt; 	013BD047  \.  C3            RETN</span><br><span class="line">&gt; </span><br><span class="line">&gt; 013BDD32   .  0FB7C0        MOVZX EAX,AX</span><br><span class="line">&gt; 013BDD35   .  83C4 04       ADD ESP,0x4</span><br><span class="line">&gt; 013BDD38   .  8947 20       MOV DWORD PTR DS:[EDI+0x20],EAX</span><br><span class="line">&gt; 013BDD3B   .  85C0          TEST EAX,EAX											;  检测上面的函数返回结果eax是否为0</span><br><span class="line">&gt; 013BDD3D   .  0F84 32010000 JE 010Edito.013BDE75;eax=0跳转到返回0xE7，验证失败</span><br><span class="line">&gt; 013BDD43   .  3D E8030000   CMP EAX,0x3E8</span><br><span class="line">&gt; 013BDD48   .  0F87 27010000 JA 010Edito.013BDE75;eax大于0x3E8跳转到返回0xE7，验证失败</span><br><span class="line">&gt; 013BDD4E   .  0FB655 E5     MOVZX EDX,BYTE PTR SS:[EBP-0x1B]						  ; edx = key[9]</span><br><span class="line">&gt; 013BDD52   .  0FB64D E0     MOVZX ECX,BYTE PTR SS:[EBP-0x20]						  ; ecx = key[4]</span><br><span class="line">&gt; 013BDD56   .  0FB6C7        MOVZX EAX,BH											; eax = key[5]</span><br><span class="line">&gt; 013BDD59   .  33D0          XOR EDX,EAX												; edx = key[9]^key[5]</span><br><span class="line">&gt; 013BDD5B   .  0FB645 E4     MOVZX EAX,BYTE PTR SS:[EBP-0x1C]						  ; eax = key[8]					</span><br><span class="line">&gt; 013BDD5F   .  33C8          XOR ECX,EAX												; ecx = key[4]^key[8]</span><br><span class="line">&gt; 013BDD61   .  C1E2 08       SHL EDX,0x8</span><br><span class="line">&gt; 013BDD64   .  0FB645 E2     MOVZX EAX,BYTE PTR SS:[EBP-0x1E]						  ; eax = key[6]</span><br><span class="line">&gt; 013BDD68   .  03D1          ADD EDX,ECX												; edx = ((key[9]^key[5])&lt;&lt;8) +  key[4]^key[8]</span><br><span class="line">&gt; 013BDD6A   .  0FB64D DC     MOVZX ECX,BYTE PTR SS:[EBP-0x24]						  ; ecx = key[0]</span><br><span class="line">&gt; 013BDD6E   .  C1E2 08       SHL EDX,0x8												; edx = (((key[9]^key[5]) &lt;&lt; 8) +  key[4]^key[8]) &lt;&lt; 8</span><br><span class="line">&gt; 013BDD71   .  33C8          XOR ECX,EAX												; ecx = key[0]^key[6]</span><br><span class="line">&gt; 013BDD73   .  03D1          ADD EDX,ECX												; edx = ((((key[9]^key[5]) &lt;&lt; 8) +  key[4]^key[8]) &lt;&lt; 8) + key[0]^key[6]</span><br><span class="line">&gt; 013BDD75   .  68 278C5B00   PUSH 010Edito.005B8C27                                       ;  CCCCCCCC</span><br><span class="line">&gt; 013BDD7A   .  52            PUSH EDX</span><br><span class="line">&gt; 013BDD7B   .  E8 0BCA04FF   CALL 010Edito.0040A78B</span><br><span class="line">&gt; 	013BCF90  /&gt; \55            PUSH EBP</span><br><span class="line">&gt; 	013BCF91  |.  8BEC          MOV EBP,ESP</span><br><span class="line">&gt; 	013BCF93  |.  8B4D 08       MOV ECX,[ARG.1]										; 	  ecx = ((((key[9]^key[5]) &lt;&lt; 8) +  key[4]^key[8]) &lt;&lt; 8) + key[0]^key[6]</span><br><span class="line">&gt; 	013BCF96  |.  B8 F1F0F0F0   MOV EAX,0xF0F0F0F1</span><br><span class="line">&gt; 	013BCF9B  |.  334D 0C       XOR ECX,[ARG.2]										; 	  ecx = (((((key[9]^key[5]) &lt;&lt; 8) +  key[4]^key[8]) &lt;&lt; 8) + key[0]^key[6])               	 ^ 0x005B8C27   </span><br><span class="line">&gt; 	013BCF9E  |.  81F1 78C02200 XOR ECX,0x22C078									; 	  ecx = ((((((key[9]^key[5]) &lt;&lt; 8) +  key[4]^key[8]) &lt;&lt; 8) + key[0]^key[6])              	 ^ 0x005B8C27)	^  0x22C078</span><br><span class="line">&gt; 	013BCFA4  |.  81E9 75C10200 SUB ECX,0x2C175					 					; 	  ecx = ((((((key[9]^key[5]) &lt;&lt; 8) +  key[4]^key[8]) &lt;&lt; 8) + key[0]^key[6])              	 ^ 0x005B8C27)	^  0x22C078 - 0x2C175</span><br><span class="line">&gt; 	013BCFAA  |.  81F1 6731E5FF XOR ECX,0xFFE53167					 				; 	  ecx = (((((((key[9]^key[5]) &lt;&lt; 8) +  key[4]^key[8]) &lt;&lt; 8) + key[0]^key[6])              	  ^ 0x005B8C27)	^  0x22C078 - 0x2C175) ^ 0xFFE53167</span><br><span class="line">&gt; 	013BCFB0  |.  81E1 FFFFFF00 AND ECX,0xFFFFFF					 				; 	  ecx = ((((((((key[9]^key[5]) &lt;&lt; 8) +  key[4]^key[8]) &lt;&lt; 8) + key[0]^key[6])              	   ^ 0x005B8C27)	^  0x22C078 - 0x2C175) ^ 0xFFE53167) &amp; 0xFFFFFF</span><br><span class="line">&gt; 	013BCFB6  |.  F7E1          MUL ECX											    ;  	   eax = 0xF0F0F0F1 * ecx    结果高32位放在edx。 低32位放在eax</span><br><span class="line">&gt; 	013BCFB8  |.  C1EA 04       SHR EDX,0x4</span><br><span class="line">&gt; 	013BCFBB  |.  8BC2          MOV EAX,EDX</span><br><span class="line">&gt; 	013BCFBD  |.  C1E0 04       SHL EAX,0x4</span><br><span class="line">&gt; 	013BCFC0  |.  03C2          ADD EAX,EDX</span><br><span class="line">&gt; 	013BCFC2  |.  2BC8          SUB ECX,EAX		;结果为0 则 zf=1</span><br><span class="line">&gt; 	013BCFC4  |.  B8 00000000   MOV EAX,0x0</span><br><span class="line">&gt; 	013BCFC9  |.  0F44C2        CMOVE EAX,EDX	;当zf = 1时移动 </span><br><span class="line">&gt; 	013BCFCC  |.  5D            POP EBP        </span><br><span class="line">&gt; 	013BCFCD  \.  C3            RETN</span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; 013BDD80   .  83C4 08       ADD ESP,0x8</span><br><span class="line">&gt; 013BDD83   .  8945 F0       MOV DWORD PTR SS:[EBP-0x10],EAX</span><br><span class="line">&gt; 013BDD86   .  8947 34       MOV DWORD PTR DS:[EDI+0x34],EAX</span><br><span class="line">&gt; 013BDD89   .  8BF0          MOV ESI,EAX</span><br><span class="line">&gt; 013BDD8B   &gt; \8D45 EC       LEA EAX,DWORD PTR SS:[EBP-0x14];0x9C分支也跳转到这里</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>转换成C代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">case</span> <span class="number">0xAC</span>:</span><br><span class="line">&gt; &#123;</span><br><span class="line">&gt;     eax = ((((key[<span class="number">1</span>]^key[<span class="number">7</span>]) * <span class="number">0x100</span> + key[<span class="number">2</span>]^key[<span class="number">5</span>])^<span class="number">0x7892</span> + <span class="number">0x4D30</span>)^<span class="number">0x3421</span>);</span><br><span class="line">&gt;     ecx = ((((((((key[<span class="number">9</span>]^key[<span class="number">5</span>]) &lt;&lt; <span class="number">8</span>) +  key[<span class="number">4</span>]^key[<span class="number">8</span>]) &lt;&lt; <span class="number">8</span>) + key[<span class="number">0</span>]^key[<span class="number">6</span>])              	   ^ <span class="number">0x005B8C27</span>)	^  <span class="number">0x22C078</span> - <span class="number">0x2C175</span>) ^ <span class="number">0xFFE53167</span>) &amp; <span class="number">0xFFFFFF</span>;</span><br><span class="line">&gt;     <span class="keyword">if</span>(eax % <span class="number">0xB</span> != <span class="number">0</span>)</span><br><span class="line">&gt;     &#123;</span><br><span class="line">&gt;         eax = <span class="number">0</span>;</span><br><span class="line">&gt;         <span class="keyword">return</span> ;	<span class="comment">//跳转返回0x7E分支，验证失败</span></span><br><span class="line">&gt;     &#125;</span><br><span class="line">&gt;     eax = ((((key[<span class="number">1</span>]^key[<span class="number">7</span>]) * <span class="number">0x100</span> + key[<span class="number">2</span>]^key[<span class="number">5</span>])^<span class="number">0x7892</span> + <span class="number">0x4D30</span>)^<span class="number">0x3421</span>)/<span class="number">0xB</span>;</span><br><span class="line">&gt;     eax = <span class="number">0xF0F0F0F1</span> * ecx;   <span class="comment">// 结果高32位放在edx。 低32位放在eax</span></span><br><span class="line">&gt;     edx = edx &gt;&gt; <span class="number">4</span>;</span><br><span class="line">&gt;     eax = edx;</span><br><span class="line">&gt;     eax = eax &lt;&lt; <span class="number">4</span>;</span><br><span class="line">&gt;     eax = eax + edx;</span><br><span class="line">&gt;     ecx = ecx - eax;</span><br><span class="line">&gt;     eax = <span class="number">0</span>;</span><br><span class="line">&gt;     <span class="keyword">if</span>（ecx==<span class="number">0</span>）</span><br><span class="line">&gt;     &#123;</span><br><span class="line">&gt;         eax = edx; </span><br><span class="line">&gt;     &#125;  </span><br><span class="line">&gt;     [ebp<span class="number">-0x10</span>] = eax;		<span class="comment">//最后一步验证用到</span></span><br><span class="line">&gt;     [edi+<span class="number">0x34</span>] = eax;</span><br><span class="line">&gt;     esi = eax;</span><br><span class="line">&gt;     <span class="keyword">break</span>;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>分支0x9C、0xAC都将运行到此处</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;013BDD8B   &gt; \8D45 EC       LEA EAX,DWORD PTR SS:[EBP-0x14]</span><br><span class="line">&gt;013BDD8E   .  50            PUSH EAX</span><br><span class="line">&gt;013BDD8F   .  8D4F 04       LEA ECX,DWORD PTR DS:[EDI+0x4]</span><br><span class="line">&gt;013BDD92   .  FF15 782BE702 CALL DWORD PTR DS:[&lt;&amp;Qt5Core.?toUtf8@QString@@QBE?AVQByteArr&gt;;  Qt5Core.?toUtf8@QString@@QBE?AVQByteArray@@XZ</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-26/12337882.jpg" alt=""></p>
<p>不知道这段是干嘛，我们继续单步，到如上图所示，函数[&lt;&amp;Qt5Core.?data@QByteArray@@QAE&gt;] 返回了用户名字符串，然后传入函数010Edito.00402E50，其再返回 一串类似哈希值的值，那么这个函数的作用应该为处理函数名称，进入分析。</p>
</blockquote>
<h3 id="第四步-分析用户名处理函数"><a href="#第四步-分析用户名处理函数" class="headerlink" title="第四步 分析用户名处理函数"></a>第四步 分析用户名处理函数</h3><blockquote>
<p>根据mov esp, 0x10可知，用户名处理函数共有四个参数</p>
<p>参数1：用户名</p>
<p>参数2：当BL=0XFC时为1，否则为0，根据前面的分析可知，BL为Key[3]</p>
<p>参数3：esi，经上一个函数处理得到</p>
<p>参数4：[edi+0x20]，经上一个函数处理得到</p>
</blockquote>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line">&gt; 013BD120  /&gt; \55            PUSH EBP</span><br><span class="line">&gt; 013BD121  |.  8BEC          MOV EBP,ESP</span><br><span class="line">&gt; 013BD123  |.  83EC 10       SUB ESP,0x10</span><br><span class="line">&gt; 013BD126  |.  8B55 08       MOV EDX,[ARG.1]</span><br><span class="line">&gt; ;edx = 用户名pName</span><br><span class="line">&gt; 013BD129  |.  33C9          XOR ECX,ECX</span><br><span class="line">&gt; ;ecx = 0</span><br><span class="line">&gt; 013BD12B  |.  56            PUSH ESI</span><br><span class="line">&gt; ;备份esi</span><br><span class="line">&gt; 013BD12C  |.  8BF2          MOV ESI,EDX</span><br><span class="line">&gt; ;esi = 用户名pName</span><br><span class="line">&gt; 013BD12E  |.  894D FC       MOV [LOCAL.1],ECX</span><br><span class="line">&gt; ;[LOCAL.1] = 0</span><br><span class="line">&gt; 013BD131  |.  57            PUSH EDI</span><br><span class="line">&gt; ;备份EDI</span><br><span class="line">&gt; 013BD132  |.  8D7E 01       LEA EDI,DWORD PTR DS:[ESI+0x1]</span><br><span class="line">&gt; ;edi = 用户名地址 + 1，后面被esi减去求得长度</span><br><span class="line">&gt; 013BD135  |&gt;  8A06          /MOV AL,BYTE PTR DS:[ESI]</span><br><span class="line">&gt; ;al = pName[0]</span><br><span class="line">&gt; 013BD137  |.  46            |INC ESI</span><br><span class="line">&gt; ;pName++</span><br><span class="line">&gt; 013BD138  |.  84C0          |TEST AL,AL</span><br><span class="line">&gt; 013BD13A  |.^ 75 F9         \JNZ SHORT 010Edito.013BD135</span><br><span class="line">&gt; ;判断是否到达字符串结尾</span><br><span class="line">&gt; 013BD13C  |.  2BF7          SUB ESI,EDI</span><br><span class="line">&gt; ;求得长度，ESI指向为用户名字符串结尾的&apos;\0&apos;</span><br><span class="line">&gt; 013BD13E  |.  33FF          XOR EDI,EDI</span><br><span class="line">&gt; 013BD140  |.  85F6          TEST ESI,ESI</span><br><span class="line">&gt; 013BD142  |.  0F8E F0000000 JLE 010Edito.013BD238</span><br><span class="line">&gt; ;检查长度是否不为0</span><br><span class="line">&gt; 013BD148  |.  53            PUSH EBX</span><br><span class="line">&gt; 013BD149  |.  8B5D 14       MOV EBX,[ARG.4]</span><br><span class="line">&gt; ;ebx = [ARG.4] = 传入的[edi+0x20]</span><br><span class="line">&gt; 013BD14C  |.  894D F0       MOV [LOCAL.4],ECX	;置零</span><br><span class="line">&gt; 013BD14F  |.  894D F4       MOV [LOCAL.3],ECX	;置零</span><br><span class="line">&gt; 013BD152  |.  8B4D 10       MOV ECX,[ARG.3]</span><br><span class="line">&gt; ;ecx = [ARG.3] = 传入的esi</span><br><span class="line">&gt; 013BD155  |.  C1E3 04       SHL EBX,0x4</span><br><span class="line">&gt; 013BD158  |.  2B5D 14       SUB EBX,[ARG.4]</span><br><span class="line">&gt; ;ebx = ([ARG.4] *16) - [ARG.4]</span><br><span class="line">&gt; 013BD15B  |.  C1E1 04       SHL ECX,0x4</span><br><span class="line">&gt; 013BD15E  |.  034D 10       ADD ECX,[ARG.3]</span><br><span class="line">&gt; ;ecx = ([ARG.3]  *16) + [ARG.3]</span><br><span class="line">&gt; 013BD161  |.  894D F8       MOV [LOCAL.2],ECX</span><br><span class="line">&gt; ;[LOCAL.2] = ([ARG.3] &lt;&lt; 4) + [ARG.3]</span><br><span class="line">&gt; 013BD164  |&gt;  0FB60417      /MOVZX EAX,BYTE PTR DS:[EDI+EDX]</span><br><span class="line">&gt; 013BD168  |.  50            |PUSH EAX                                                    ; /c = B6</span><br><span class="line">&gt; 013BD169  |.  FF15 9422E702 |CALL DWORD PTR DS:[&lt;&amp;MSVCR120.toupper&gt;]                     ; \toupper  小写字母转换为大写字母</span><br><span class="line">&gt; 013BD16F  |.  8BD0          |MOV EDX,EAX</span><br><span class="line">&gt; ;返回值复制给edx，大写字符</span><br><span class="line">&gt; 013BD171  |.  83C4 04       |ADD ESP,0x4</span><br><span class="line">&gt; 013BD174  |.  8B0C95 4841E6&gt;|MOV ECX,DWORD PTR DS:[EDX*4+0x2E64148]</span><br><span class="line">&gt; ;将大写字母作为索引从数组0x2E64148中取内容</span><br><span class="line">&gt; ;为了方便，把数组0x2E64148称为nArray，故这里ecx = nArray[edx]</span><br><span class="line">&gt; 013BD17B  |.  034D FC       |ADD ECX,[LOCAL.1]</span><br><span class="line">&gt; ;ecx =nArray[大写字符] + [LOCAL.1] ,[LOCAL.1]最初为0</span><br><span class="line">&gt; 013BD17E  |.  837D 0C 00    |CMP [ARG.2],0x0</span><br><span class="line">&gt; ;判断是哪种类型的注册</span><br><span class="line">&gt; 013BD182  |.  74 4A         |JE SHORT 010Edito.013BD1CE</span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; ;注册类型1---------------------------------------------------------</span><br><span class="line">&gt; 013BD184  |.  8D42 0D       |LEA EAX,DWORD PTR DS:[EDX+0xD]	</span><br><span class="line">&gt; 013BD187  |.  25 FF000000   |AND EAX,0xFF</span><br><span class="line">&gt; ;eax = [大写字符+0xD] &amp; 0xFF，这个值为数组下标，与0xFF可能说明数组最大个数为0xFF,即256个</span><br><span class="line">&gt; 013BD18C  |.  330C85 4841E6&gt;|XOR ECX,DWORD PTR DS:[EAX*4+0x2E64148]</span><br><span class="line">&gt; ;ecx = (nArray[大写字符] + [LOCAL.1]) ^ nArray[eax]</span><br><span class="line">&gt; 013BD193  |.  8D42 2F       |LEA EAX,DWORD PTR DS:[EDX+0x2F]</span><br><span class="line">&gt; ;eax = [大写字符+0x2F]</span><br><span class="line">&gt; 013BD196  |.  25 FF000000   |AND EAX,0xFF</span><br><span class="line">&gt; ;eax = eax &amp; 0xFF</span><br><span class="line">&gt; 013BD19B  |.  0FAF0C85 4841&gt;|IMUL ECX,DWORD PTR DS:[EAX*4+0x2E64148]</span><br><span class="line">&gt; ;ecx = ecx*nArray[eax]</span><br><span class="line">&gt; 013BD1A3  |.  8B45 F8       |MOV EAX,[LOCAL.2]                                           ;  010Edito.01885E59</span><br><span class="line">&gt; ;eax = [LOCAL.2] = ([ARG.3] &lt;&lt; 4) + [ARG.3]</span><br><span class="line">&gt; 013BD1A6  |.  0FB6C0        |MOVZX EAX,AL</span><br><span class="line">&gt; ;eax &amp;= 0xFF</span><br><span class="line">&gt; 013BD1A9  |.  030C85 4841E6&gt;|ADD ECX,DWORD PTR DS:[EAX*4+0x2E64148]</span><br><span class="line">&gt; ;ecx = ecx + nArray[eax]</span><br><span class="line">&gt; 013BD1B0  |.  0FB6C3        |MOVZX EAX,BL</span><br><span class="line">&gt; ;eax = ebx = ([ARG.4] &lt;&lt; 4) - [ARG.4]</span><br><span class="line">&gt; 013BD1B3  |.  030C85 4841E6&gt;|ADD ECX,DWORD PTR DS:[EAX*4+0x2E64148]</span><br><span class="line">&gt; ;ecx = ecx + nArray[eax]</span><br><span class="line">&gt; 013BD1BA  |.  8B45 F4       |MOV EAX,[LOCAL.3]</span><br><span class="line">&gt; ;eax = [LOCAL.3]</span><br><span class="line">&gt; 013BD1BD  |.  0FB6C0        |MOVZX EAX,AL</span><br><span class="line">&gt; 013BD1C0  |.  030C85 4841E6&gt;|ADD ECX,DWORD PTR DS:[EAX*4+0x2E64148]</span><br><span class="line">&gt; ;ecx = ecx + nArray[eax]</span><br><span class="line">&gt; 013BD1C7  |.  8BC1          |MOV EAX,ECX</span><br><span class="line">&gt; ;eax = ecx</span><br><span class="line">&gt; 013BD1C9  |.  8945 FC       |MOV [LOCAL.1],EAX</span><br><span class="line">&gt; ;[LOCAL.1] = eax</span><br><span class="line">&gt; 013BD1CC  |.  EB 48         |JMP SHORT 010Edito.013BD216</span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; ;注册类型0----------------------------------------------------------</span><br><span class="line">&gt; 013BD1CE  |&gt;  8D42 3F       |LEA EAX,DWORD PTR DS:[EDX+0x3F];这里不同</span><br><span class="line">&gt; 013BD1D1  |.  25 FF000000   |AND EAX,0xFF</span><br><span class="line">&gt; 013BD1D6  |.  330C85 4841E6&gt;|XOR ECX,DWORD PTR DS:[EAX*4+0x2E64148]</span><br><span class="line">&gt; 013BD1DD  |.  8D42 17       |LEA EAX,DWORD PTR DS:[EDX+0x17];这里不同</span><br><span class="line">&gt; 013BD1E0  |.  25 FF000000   |AND EAX,0xFF</span><br><span class="line">&gt; 013BD1E5  |.  0FAF0C85 4841&gt;|IMUL ECX,DWORD PTR DS:[EAX*4+0x2E64148]</span><br><span class="line">&gt; 013BD1ED  |.  8B45 F8       |MOV EAX,[LOCAL.2]                                           ;  010Edito.01885E59</span><br><span class="line">&gt; 013BD1F0  |.  0FB6C0        |MOVZX EAX,AL</span><br><span class="line">&gt; 013BD1F3  |.  030C85 4841E6&gt;|ADD ECX,DWORD PTR DS:[EAX*4+0x2E64148]</span><br><span class="line">&gt; 013BD1FA  |.  0FB6C3        |MOVZX EAX,BL</span><br><span class="line">&gt; 013BD1FD  |.  030C85 4841E6&gt;|ADD ECX,DWORD PTR DS:[EAX*4+0x2E64148]</span><br><span class="line">&gt; 013BD204  |.  8B45 F0       |MOV EAX,[LOCAL.4]</span><br><span class="line">&gt; ;eax = [LOCAL.4], 另一种注册类型这里为 [LOCAL.3]</span><br><span class="line">&gt; 013BD207  |.  0FB6C0        |MOVZX EAX,AL</span><br><span class="line">&gt; 013BD20A  |.  030C85 4841E6&gt;|ADD ECX,DWORD PTR DS:[EAX*4+0x2E64148]</span><br><span class="line">&gt; 013BD211  |.  8BC1          |MOV EAX,ECX</span><br><span class="line">&gt; 013BD213  |.  894D FC       |MOV [LOCAL.1],ECX</span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; ;共通线----------------------------------------------------------------</span><br><span class="line">&gt; 013BD216  |&gt;  8345 F4 13    |ADD [LOCAL.3],0x13</span><br><span class="line">&gt; ;[LOCAL.3] += 0x13</span><br><span class="line">&gt; 013BD21A  |.  47            |INC EDI</span><br><span class="line">&gt; 013BD21B  |.  8345 F8 09    |ADD [LOCAL.2],0x9</span><br><span class="line">&gt; ;[LOCAL.2] += 0x9</span><br><span class="line">&gt; 013BD21F  |.  83C3 0D       |ADD EBX,0xD</span><br><span class="line">&gt; ;EBX += 0xD</span><br><span class="line">&gt; 013BD222  |.  8345 F0 07    |ADD [LOCAL.4],0x7</span><br><span class="line">&gt; ;[LOCAL.4] += 0x7</span><br><span class="line">&gt; 013BD226  |.  8B55 08       |MOV EDX,[ARG.1]</span><br><span class="line">&gt; ; EDX = [ARG.1] = 用户名</span><br><span class="line">&gt; 013BD229  |.  3BFE          |CMP EDI,ESI</span><br><span class="line">&gt; ;ESI指向为用户名字符串结尾的0， 判断EDI是否也到结尾，没有则继续循环计算</span><br><span class="line">&gt; 013BD22B  |.^ 0F8C 33FFFFFF \JL 010Edito.013BD164</span><br><span class="line">&gt; 013BD231  |.  5B            POP EBX                                                      ;  05661E08</span><br><span class="line">&gt; 013BD232  |.  5F            POP EDI                                                      ;  05661E08</span><br><span class="line">&gt; 013BD233  |.  5E            POP ESI                                                      ;  05661E08</span><br><span class="line">&gt; 013BD234  |.  8BE5          MOV ESP,EBP</span><br><span class="line">&gt; 013BD236  |.  5D            POP EBP                                                      ;  05661E08</span><br><span class="line">&gt; 013BD237  |.  C3            RETN</span><br><span class="line">&gt; </span><br><span class="line">&gt;  ;用户名长度为0------------------------------------------------------</span><br><span class="line">&gt; 013BD238  |&gt;  5F            POP EDI                                                      ;  05661E08</span><br><span class="line">&gt; 013BD239  |.  8BC1          MOV EAX,ECX</span><br><span class="line">&gt; 013BD23B  |.  5E            POP ESI                                                      ;  05661E08</span><br><span class="line">&gt; 013BD23C  |.  8BE5          MOV ESP,EBP</span><br><span class="line">&gt; 013BD23E  |.  5D            POP EBP                                                      ;  05661E08</span><br><span class="line">&gt; 013BD23F  \.  C3            RETN</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>转换成C语言</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&gt; arg_1 = pName;</span><br><span class="line">&gt; arg_2;</span><br><span class="line">&gt; arg_3 = ESI;</span><br><span class="line">&gt; arg_4 = [edi+<span class="number">0x20</span>];</span><br><span class="line">&gt; </span><br><span class="line">&gt; DWORD LOCAL_1 = <span class="number">0</span>;</span><br><span class="line">&gt; DWORD LOCAL_2 = (arg_3 * <span class="number">16</span>) + arg_3</span><br><span class="line">&gt; DWORD LOCAL_3 = <span class="number">0</span>;</span><br><span class="line">&gt; DWORD LOCAL_4 = <span class="number">0</span>;</span><br><span class="line">&gt; </span><br><span class="line">&gt; ebx =(arg_4 * <span class="number">16</span>) - arg_4;</span><br><span class="line">&gt; <span class="keyword">char</span> nArray[<span class="number">256</span>]=</span><br><span class="line">&gt; &#123;</span><br><span class="line">&gt; <span class="number">39</span>CB44B8,	<span class="number">23754F</span>67,	<span class="number">5F</span>017211,   <span class="number">3</span>EBB24DA,   <span class="number">351707</span>C6,	<span class="number">63F</span>9774B,	<span class="number">17827288</span>,	<span class="number">0F</span>E74821,	<span class="number">5B</span>5F670F,	<span class="number">48315</span>AE8,	<span class="number">785B</span>7769,	<span class="number">2B</span>7A1547,	<span class="number">38</span>D11292,	<span class="number">42</span>A11B32,	<span class="number">35332244</span>,	<span class="number">77437B</span>60,	<span class="number">1</span>EAB3B10,	<span class="number">53810000</span>,	<span class="number">1</span>D0212AE,	<span class="number">6F</span>0377A8,	<span class="number">43</span>C03092,	<span class="number">2</span>D3C0A8E,	<span class="number">62950</span>CBF,	<span class="number">30F</span>06FFA,	<span class="number">34F</span>710E0,	<span class="number">28F</span>417FB,	<span class="number">350</span>D2F95,	<span class="number">5</span>A361D5A,	<span class="number">15</span>CC060B,	<span class="number">0</span>AFD13CC,	<span class="number">28603B</span>CF,	<span class="number">3371066B</span>,	<span class="number">30</span>CD14E4,	<span class="number">175</span>D3A67,	<span class="number">6</span>DD66A13,	<span class="number">2</span>D3409F9,	<span class="number">581E7</span>B82,	<span class="number">76526B</span>99,	<span class="number">5</span>C8D5188,	<span class="number">2</span>C857971,	<span class="number">15F</span>51FC0,	<span class="number">68</span>CC0D11,	<span class="number">49F</span>55E5C,	<span class="number">275E4364</span>,	<span class="number">2</span>D1E0DBC,	<span class="number">4</span>CEE7CE3,	<span class="number">32555840</span>,	<span class="number">112E2</span>E08,	<span class="number">6978065</span>A,	<span class="number">72921406</span>,	<span class="number">314578E7</span>,	<span class="number">175621B</span>7,	<span class="number">40771</span>DBF,	<span class="number">3F</span>C238D6,	<span class="number">4</span>A31128A,	<span class="number">2</span>DAD036E,	<span class="number">41</span>A069D6,	<span class="number">25400192</span>,	<span class="number">00</span>DD4667,	<span class="number">6</span>AFC1F4F,	<span class="number">571040</span>CE,	<span class="number">62F</span>E66DF,	<span class="number">41</span>DB4B3E,	<span class="number">3582231F</span>,	<span class="number">55F</span>6079A,	<span class="number">1</span>CA70644,	<span class="number">1B</span>1643D2,	<span class="number">3F</span>7228C9,	<span class="number">5F</span>141070,	<span class="number">3E1474</span>AB,	<span class="number">444B</span>256E,	<span class="number">537050</span>D9,	<span class="number">0F</span>42094B,	<span class="number">2F</span>D820E6,	<span class="number">778B</span>2E5E,	<span class="number">71176</span>D02,	<span class="number">7F</span>EA7A69,	<span class="number">5B</span>B54628,	<span class="number">19B</span>A6C71,	<span class="number">39763</span>A99,	<span class="number">178</span>D54CD,	<span class="number">01246E88</span>,	<span class="number">3313537</span>E,	<span class="number">2B</span>8E2D17,	<span class="number">2</span>A3D10BE,	<span class="number">59</span>D10582,	<span class="number">37</span>A163DB,	<span class="number">30</span>D6489A,	<span class="number">6</span>A215C46,	<span class="number">0E1</span>C7A76,	<span class="number">1F</span>C760E7,	<span class="number">79B</span>80C65,	<span class="number">27F</span>459B4,	<span class="number">799</span>A7326,	<span class="number">50B</span>A1782,	<span class="number">2</span>A116D5C,	<span class="number">63866E1</span>B,	<span class="number">3F</span>920E3C,	<span class="number">55023490</span>,	<span class="number">55B</span>56089,	<span class="number">2</span>C391FD1,	<span class="number">2F</span>8035C2,	<span class="number">64F</span>D2B7A,	<span class="number">4</span>CE8759A,	<span class="number">518504F</span>0,	<span class="number">799501</span>A8,	<span class="number">3F</span>5B2CAD,	<span class="number">38E60160</span>,	<span class="number">637641</span>D8,	<span class="number">33352</span>A42,	<span class="number">51</span>A22C19,	<span class="number">085</span>C5851,	<span class="number">032917</span>AB,	<span class="number">2B</span>770AC7,	<span class="number">30</span>AC77B3,	<span class="number">2B</span>EC1907,	<span class="number">035202</span>D0,	<span class="number">0F</span>A933D3,	<span class="number">61255</span>DF3,	<span class="number">22</span>AD06BF,	<span class="number">58B</span>86971,	<span class="number">5F</span>CA0DE5,	<span class="number">700</span>D6456,	<span class="number">56</span>A973DB,	<span class="number">5</span>AB759FD,	<span class="number">330E0</span>BE2,	<span class="number">5B</span>3C0DDD,	<span class="number">495</span>D3C60,	<span class="number">53B</span>D59A6,	<span class="number">4</span>C5E6D91,	<span class="number">49</span>D9318D,	<span class="number">103</span>D5079,	<span class="number">61</span>CE42E3,	<span class="number">7</span>ED5121D,	<span class="number">14E160</span>ED,	<span class="number">212</span>D4EF2,	<span class="number">270133F</span>0,	<span class="number">62435</span>A96,	<span class="number">1F</span>A75E8B,	<span class="number">6F</span>092FBE,	<span class="number">4</span>A000D49,	<span class="number">57</span>AE1C70,	<span class="number">004E2477</span>,	<span class="number">561E7</span>E72,	<span class="number">468</span>C0033,	<span class="number">5</span>DCC2402,	<span class="number">78507</span>AC6,	<span class="number">58</span>AF24C7,	<span class="number">0</span>DF62D34,	<span class="number">358</span>A4708,	<span class="number">3</span>CFB1E11,	<span class="number">2B</span>71451C,	<span class="number">77</span>A75295,	<span class="number">56890721</span>,	<span class="number">0F</span>EF75F3,	<span class="number">120F</span>24F1,	<span class="number">01990</span>AE7,	<span class="number">339</span>C4452,	<span class="number">27</span>A15B8E,	<span class="number">0B</span>A7276D,	<span class="number">60</span>DC1B7B,	<span class="number">4F</span>4B7F82,	<span class="number">67</span>DB7007,	<span class="number">4F</span>4A57D9,	<span class="number">621252E8</span>,	<span class="number">20532</span>CFC,	<span class="number">6</span>A390306,	<span class="number">18800423</span>,	<span class="number">19F</span>3778A,	<span class="number">462316F</span>0,	<span class="number">56</span>AE0937,	<span class="number">43</span>C2675C,	<span class="number">65</span>CA45FD,	<span class="number">0</span>D604FF2,	<span class="number">0B</span>FD22CB,	<span class="number">3</span>AFE643B,	<span class="number">3B</span>F67FA6,	<span class="number">44623579</span>,	<span class="number">184031F</span>8,	<span class="number">32174F</span>97,	<span class="number">4</span>C6A092A,	<span class="number">5F</span>B50261,	<span class="number">01650174</span>,	<span class="number">33634</span>AF1,	<span class="number">712</span>D18F4,	<span class="number">6E997169</span>,	<span class="number">5</span>DAB7AFE,	<span class="number">7</span>C2B2EE8,	<span class="number">6</span>EDB75B4,	<span class="number">5F</span>836FB6,	<span class="number">3</span>C2A6DD6,	<span class="number">292</span>D05C2,	<span class="number">052244</span>DB,	<span class="number">149</span>A5F4F,	<span class="number">5</span>D486540,	<span class="number">331</span>D15EA,	<span class="number">4F</span>456920,	<span class="number">483</span>A699F,	<span class="number">3B</span>450F05,	<span class="number">3B</span>207C6C,	<span class="number">749</span>D70FE,	<span class="number">417461F</span>6,	<span class="number">62B</span>031F1,	<span class="number">2750577B</span>,	<span class="number">29131533</span>,	<span class="number">588</span>C3808,	<span class="number">1</span>AEF3456,	<span class="number">0F</span>3C00EC,	<span class="number">7</span>DA74742,	<span class="number">4B</span>797A6C,	<span class="number">5</span>EBB3287,	<span class="number">786558B</span>8,	<span class="number">00</span>ED4FF2,	<span class="number">6269691</span>E,	<span class="number">24</span>A2255F,	<span class="number">62</span>C11F7E,	<span class="number">2F</span>8A7DCD,	<span class="number">643B</span>17FE,	<span class="number">778318B</span>8,	<span class="number">253B</span>60FE,	<span class="number">34B</span>B63A3,	<span class="number">5B</span>03214F,	<span class="number">5F</span>1571F4,	<span class="number">1</span>A316E9F,	<span class="number">7</span>ACF2704,	<span class="number">28896838</span>,	<span class="number">18614677</span>,	<span class="number">1B</span>F569EB,	<span class="number">0B</span>A85EC9,	<span class="number">6</span>ACA6B46,	<span class="number">1E43422</span>A,	<span class="number">514</span>D5F0E,	<span class="number">413E018</span>C,	<span class="number">307626E9</span>,	<span class="number">01</span>ED1DFA,	<span class="number">49F</span>46F5A,	<span class="number">461B</span>642B,	<span class="number">7</span>D7007F2,	<span class="number">13652657</span>,	<span class="number">6B</span>160BC5,	<span class="number">65E04849</span>,	<span class="number">1F</span>526E1C,	<span class="number">5</span>A0251B6,	<span class="number">2B</span>D73F69,	<span class="number">2</span>DBF7ACD,	<span class="number">51E63</span>E80,	<span class="number">5</span>CF2670F,	<span class="number">21</span>CD0A03,	<span class="number">5</span>CFF0261,	<span class="number">33</span>AE061E,	<span class="number">3B</span>B6345F,	<span class="number">5</span>D814A75,	<span class="number">257B</span>5DF4,	<span class="number">0</span>A5C2C5B,	<span class="number">16</span>A45527,	<span class="number">16F</span>23945</span><br><span class="line">&gt; &#125;;</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">while</span>(nNameLen)</span><br><span class="line">&gt; &#123;</span><br><span class="line">&gt; 	pName[i]</span><br><span class="line">&gt; 	<span class="keyword">char</span> cName = <span class="built_in">toupper</span>(pName); 	<span class="comment">//小写转大写</span></span><br><span class="line">&gt; 	</span><br><span class="line">&gt; 	<span class="comment">//注册类型1</span></span><br><span class="line">&gt; 	<span class="keyword">if</span>(key[<span class="number">3</span>] != <span class="number">0xFC</span>)</span><br><span class="line">&gt; 	&#123;</span><br><span class="line">&gt; 		LOCAL_1 = (nArray[cName]+LOCAL_1);</span><br><span class="line">&gt; 		LOCAL_1 ^= nArray[(cName+<span class="number">0xD</span>)];</span><br><span class="line">&gt; 		LOCAL_1 *= nArray[(cName+<span class="number">0x2F</span>)];</span><br><span class="line">&gt; 		</span><br><span class="line">&gt; 		LOCAL_1 += nArray[LOCAL_2];</span><br><span class="line">&gt; 		LOCAL_1 += nArray[ebx];</span><br><span class="line">&gt; 		LOCAL_1 += nArray[LOCAL_3];</span><br><span class="line">&gt; 	&#125;</span><br><span class="line">&gt; 	<span class="comment">//注册类型0,没有用到</span></span><br><span class="line">&gt; 	<span class="keyword">else</span> <span class="keyword">if</span>(key[<span class="number">3</span>] == <span class="number">0xFC</span>)</span><br><span class="line">&gt; 	&#123;</span><br><span class="line">&gt; 		LOCAL_1 = (nArray[cName]+LOCAL_1);</span><br><span class="line">&gt; 		LOCAL_1 ^= nArray[(cName+<span class="number">0x3F</span>)];</span><br><span class="line">&gt; 		LOCAL_1 *= nArray[(cName+<span class="number">0x17</span>)];</span><br><span class="line">&gt; 		</span><br><span class="line">&gt; 		LOCAL_1 += nArray[LOCAL_2];</span><br><span class="line">&gt; 		LOCAL_1 += nArray[ebx];</span><br><span class="line">&gt; 		LOCAL_1 += nArray[LOCAL_4];</span><br><span class="line">&gt; 	&#125;</span><br><span class="line">&gt; 	LOCAL_3 += <span class="number">0x13</span>;</span><br><span class="line">&gt; 	nNameLen--;</span><br><span class="line">&gt; 	LOCAL_2 += <span class="number">0x9</span>;</span><br><span class="line">&gt; 	ebx += <span class="number">0xD</span> </span><br><span class="line">&gt; 	LOCAL_4 += <span class="number">0x7</span>;</span><br><span class="line">&gt; 	i++;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; <span class="keyword">return</span> LOCAL_1;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-29/95428142.jpg" alt=""></p>
<p>函数返回结果如上图。</p>
</blockquote>
<h3 id="第五步-处理计算结果"><a href="#第五步-处理计算结果" class="headerlink" title="第五步 处理计算结果"></a>第五步 处理计算结果</h3><blockquote>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-29/64922732.jpg" alt=""></p>
<p>由上图分析可知，接下来将处理用户名函数的返回值多次右移比较，根据结果分发返回值，最终跳转到我们需要的返回值0x2D。代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&gt;013BDDB6   .  E8 955004FF   CALL 010Edito.00402E50			 ;  处理用户名的函数</span><br><span class="line">&gt;013BDDBB   .  8BD0          MOV EDX,EAX</span><br><span class="line">&gt;013BDDBD   .  83C4 10       ADD ESP,0x10                      ;  意味着上面函数有四个参数</span><br><span class="line">&gt;013BDDC0   .  3855 E0       CMP BYTE PTR SS:[EBP-0x20],DL     ;  比较key[4]，返回值低8位</span><br><span class="line">&gt;013BDDC3   .  0F85 81000000 JNZ 010Edito.013BDE4A             ;  跳转到返回0xE7，失败</span><br><span class="line">&gt;013BDDC9   .  8BCA          MOV ECX,EDX</span><br><span class="line">&gt;013BDDCB   .  C1E9 08       SHR ECX,0x8                       ;  右移0x8</span><br><span class="line">&gt;013BDDCE   .  3AF9          CMP BH,CL                         ;  key[5],cl</span><br><span class="line">&gt;013BDDD0   .  75 78         JNZ SHORT 010Edito.013BDE4A       ;  跳转到返回0xE7，失败</span><br><span class="line">&gt;013BDDD2   .  8BCA          MOV ECX,EDX</span><br><span class="line">&gt;013BDDD4   .  C1E9 10       SHR ECX,0x10                      ;  右移10位</span><br><span class="line">&gt;013BDDD7   .  384D E2       CMP BYTE PTR SS:[EBP-0x1E],CL     ;  key[6]</span><br><span class="line">&gt;013BDDDA   .  75 6E         JNZ SHORT 010Edito.013BDE4A       ;  跳转到返回0xE7，失败</span><br><span class="line">&gt;013BDDDC   .  C1E8 18       SHR EAX,0x18                      ;  右移0x18</span><br><span class="line">&gt;013BDDDF   .  3845 E3       CMP BYTE PTR SS:[EBP-0x1D],AL     ;  key[7]</span><br><span class="line">&gt;013BDDE2   .  75 66         JNZ SHORT 010Edito.013BDE4A       ;  跳转到返回0xE7，失败</span><br><span class="line">&gt;013BDDE4   .  80FB 9C       CMP BL,0x9C                       ;  Switch (cases 9C..FC)</span><br><span class="line">&gt;013BDDE7   .  75 0F         JNZ SHORT 010Edito.013BDDF8</span><br><span class="line">&gt;013BDDE9   .  8B45 08       MOV EAX,DWORD PTR SS:[EBP+0x8]    ;  Case 9C of switch 013BDDE4</span><br><span class="line">&gt;013BDDEC   .  3B47 1C       CMP EAX,DWORD PTR DS:[EDI+0x1C]		; 小于等于</span><br><span class="line">&gt;013BDDEF   .  76 52         JBE SHORT 010Edito.013BDE43       ;  跳转到返回0x2D，验证正确</span><br><span class="line">&gt;013BDDF1   .  BE 4E000000   MOV ESI,0x4E</span><br><span class="line">&gt;013BDDF6   .  EB 57         JMP SHORT 010Edito.013BDE4F		 ;  返回返回4E，验证失败</span><br><span class="line">&gt;013BDDF8   &gt;  80FB FC       CMP BL,0xFC</span><br><span class="line">&gt;013BDDFB   .  75 2E         JNZ SHORT 010Edito.013BDE2B		 ;  FC分支得不到正确结果，跳过</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&gt;013BDE2B   &gt;  80FB AC       CMP BL,0xAC</span><br><span class="line">&gt;013BDE2E   .  75 1A         JNZ SHORT 010Edito.013BDE4A</span><br><span class="line">&gt;013BDE30   .  8B45 F0       MOV EAX,DWORD PTR SS:[EBP-0x10]   ;  Case AC of switch 013BDDE4</span><br><span class="line">&gt;013BDE33   .  85C0          TEST EAX,EAX</span><br><span class="line">&gt;013BDE35   .  74 13         JE SHORT 010Edito.013BDE4A        ;  跳转到验证错误</span><br><span class="line">&gt;013BDE37   .  3945 0C       CMP DWORD PTR SS:[EBP+0xC],EAX</span><br><span class="line">&gt;013BDE3A   .  76 07         JBE SHORT 010Edito.013BDE43       ;  跳转到返回0x2D,验证正确</span><br><span class="line">&gt;013BDE3C   .  BE 4E000000   MOV ESI,0x4E</span><br><span class="line">&gt;013BDE41   .  EB 0C         JMP SHORT 010Edito.013BDE4F</span><br><span class="line">&gt;013BDE43   &gt;  BE 2D000000   MOV ESI,0x2D					;  验证正确，返回0x2D!!!!</span><br><span class="line">&gt;013BDE48   .  EB 05         JMP SHORT 010Edito.013BDE4F</span><br><span class="line">&gt;013BDE4A   &gt;  BE E7000000   MOV ESI,0xE7                      ;  Default case of switch 013BDDE4</span><br><span class="line">&gt;013BDE4F   &gt;  8D4D EC       LEA ECX,DWORD PTR SS:[EBP-0x14]</span><br><span class="line">&gt;013BDE52   .  C745 FC FFFFF&gt;MOV DWORD PTR SS:[EBP-0x4],-0x1</span><br><span class="line">&gt;013BDE59   .  FF15 7C24E702 CALL DWORD PTR DS:[&lt;&amp;Qt5Core.??1Q&gt;;  Qt5Core.??1QByteArray@@QAE@XZ</span><br><span class="line">&gt;013BDE5F   .  8BC6          MOV EAX,ESI</span><br><span class="line">&gt;013BDE61   .  8B4D F4       MOV ECX,DWORD PTR SS:[EBP-0xC]</span><br><span class="line">&gt;013BDE64   .  64:890D 00000&gt;MOV DWORD PTR FS:[0],ECX</span><br><span class="line">&gt;013BDE6B   .  59            POP ECX                           ;  0584FD48</span><br><span class="line">&gt;013BDE6C   .  5F            POP EDI                           ;  0584FD48</span><br><span class="line">&gt;013BDE6D   .  5E            POP ESI                           ;  0584FD48</span><br><span class="line">&gt;013BDE6E   .  5B            POP EBX                           ;  0584FD48</span><br><span class="line">&gt;013BDE6F   .  8BE5          MOV ESP,EBP</span><br><span class="line">&gt;013BDE71   .  5D            POP EBP                           ;  0584FD48</span><br><span class="line">&gt;013BDE72   .  C2 0800       RETN 0x8</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>上述代码中，将返回值低八位和key[ n ]进行比较，每次比较完后右移八位，再次比较新数值的低八位。总共比较4次，正好将32位返回值全部比对完。</p>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-29/70206066.jpg" alt=""></p>
<p>在第三步分析0x9C分支中已经得到 [EDI+0x1C] = ecx = (key[0]^key[6]^0x18+0x3D)^0xA7，</p>
<p>局部变量 [ EBP+0x8 ] = 9。</p>
<p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-29/54812500.jpg" alt=""></p>
<p>局部变量[ EBP - 0x10] 为第三步中分析AC分支返回eax得到，</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; eax = ((((key[<span class="number">1</span>]^key[<span class="number">7</span>]) * <span class="number">0x100</span> + key[<span class="number">2</span>]^key[<span class="number">5</span>])^<span class="number">0x7892</span> + <span class="number">0x4D30</span>)^<span class="number">0x3421</span>)/<span class="number">0xB</span>;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>局部变量 [ EBP+0xC ] = 4389。</p>
<p>转换为C代码为</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="comment">//将返回值看成为一个数组，nArray[4]</span></span><br><span class="line">&gt;<span class="keyword">if</span>((nArray[<span class="number">0</span>]==key[<span class="number">4</span>]) &amp;&amp;</span><br><span class="line">&gt;   (nArray[<span class="number">1</span>]==key[<span class="number">5</span>]) &amp;&amp;</span><br><span class="line">&gt;   (nArray[<span class="number">2</span>]==key[<span class="number">6</span>]) &amp;&amp;</span><br><span class="line">&gt;   (nArray[<span class="number">3</span>]==key[<span class="number">7</span>]))</span><br><span class="line">&gt;   &#123;</span><br><span class="line">&gt;   <span class="keyword">if</span>(key[<span class="number">3</span>]==<span class="number">0x9C</span>)</span><br><span class="line">&gt;   &#123;</span><br><span class="line">&gt;            <span class="comment">//[EDI+0x1C] = (key[0]^key[6]^0x18+0x3D)^0xA7;</span></span><br><span class="line">&gt;   <span class="keyword">if</span>(<span class="number">9</span> &lt;= (key[<span class="number">0</span>]^key[<span class="number">6</span>]^<span class="number">0x18</span>+<span class="number">0x3D</span>)^<span class="number">0xA7</span>))</span><br><span class="line">&gt;   &#123;</span><br><span class="line">&gt;	   <span class="keyword">return</span> <span class="number">0x2D</span>;	<span class="comment">//验证成功</span></span><br><span class="line">&gt;   &#125;</span><br><span class="line">&gt;   <span class="keyword">return</span> <span class="number">0x4E</span>;	<span class="comment">//验证失败</span></span><br><span class="line">&gt;   &#125;</span><br><span class="line">&gt;   <span class="keyword">else</span> <span class="keyword">if</span>(key[<span class="number">3</span>]==<span class="number">0xFC</span>)</span><br><span class="line">&gt;   &#123;</span><br><span class="line">&gt;    <span class="keyword">return</span> <span class="number">0xE7</span>;	<span class="comment">//验证失败</span></span><br><span class="line">&gt;   &#125;</span><br><span class="line">&gt;   <span class="keyword">else</span> <span class="keyword">if</span>(key[<span class="number">3</span>]=<span class="number">0xAC</span>)</span><br><span class="line">&gt;   &#123;</span><br><span class="line">&gt;   <span class="keyword">if</span>([ebp - <span class="number">10</span>] &gt;= <span class="number">4389</span>)	</span><br><span class="line">&gt;   &#123;</span><br><span class="line">&gt;	   <span class="keyword">return</span> <span class="number">0x2D</span>;	<span class="comment">//验证成功</span></span><br><span class="line">&gt;   &#125;</span><br><span class="line">&gt;   <span class="keyword">return</span> <span class="number">0x4E</span>;	<span class="comment">//验证失败</span></span><br><span class="line">&gt;   &#125;</span><br><span class="line">&gt;   &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
</blockquote>
<h3 id="第六步-编写注册机"><a href="#第六步-编写注册机" class="headerlink" title="第六步 编写注册机"></a>第六步 编写注册机</h3><p><img src="http://yusakul-blog.oss-cn-shenzhen.aliyuncs.com/18-6-30/44262809.jpg" alt=""></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">梁言</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2018/06/25/010 Editor分析/">http://yoursite.com/2018/06/25/010 Editor分析/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">梁言</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/逆向工程/">逆向工程</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/06/25/java文件读写操作/"><i class="fa fa-chevron-left">  </i><span>010 Editor v8.0.1_x32分析以及注册机制作</span></a></div><div class="next-post pull-right"><a href="/2018/06/21/分析KiTrap03, CommonDisPatchException, KiDispatchException, KiUserExceptionDispatcher/"><span>分析KiTrap03, CommonDisPatchException, KiDispatchException, KiUserExceptionDispatcher</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 By 梁言</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.5"></script><script src="/js/fancybox.js?version=1.5.5"></script><script src="/js/sidebar.js?version=1.5.5"></script><script src="/js/copy.js?version=1.5.5"></script><script src="/js/fireworks.js?version=1.5.5"></script><script src="/js/transition.js?version=1.5.5"></script><script src="/js/scroll.js?version=1.5.5"></script><script src="/js/head.js?version=1.5.5"></script></body></html>